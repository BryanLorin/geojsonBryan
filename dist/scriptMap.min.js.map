{"version":3,"sources":["scriptMap.js"],"names":["ventes","map","L","setView","tileLayer","maxZoom","sectionsLayer","select","totalVentes","clickedCommunes","addEventListener","filterCommunes","departementCode","communes","filterSections","communeCode","sections","features","filter","startsWith","section","document","getElementById","eachLayer","removeLayer","layer","fetch","response","then","onEachFeature","region","geoJSON","data","feature","on","properties","code","concat","filteredCommunes","communesLayer","json","ventesDansCetteCommune","vente","length","setStyle","fillColor","JSON","parse","l_codinsee","replace","includes","textContent","push","filteredSections","checked","sectionCode","ventesDansCetteSection","l_section","addTo","forEach","commune"],"mappings":"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","file":"scriptMap.min.js","sourcesContent":["var map = L.map('map').setView([45.7, 3.15], 7);\n\nL.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n  maxZoom: 19,\n}).addTo(map);\n\nvar ventes;\nvar totalVentes = 0;\nvar clickedCommunes = [];\n\nvar communesLayer;\nvar sectionsLayer;\nvar select = document.getElementById('region');\n\nselect.addEventListener('change', function () {\n  var region = this.value;\n  map.eachLayer(function (layer) {\n    map.removeLayer(layer);\n  });\n\n  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n    maxZoom: 19,\n  }).addTo(map);\n\n  fetch(`https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/${region}/departements-${region}.geojson`)\n    .then(function (response) {\n      return response.json();\n    })\n    .then(function (departements) {\n      L.geoJSON(departements, {\n        onEachFeature: function (feature, layer) {\n          layer.on('click', function () {\n            var departementCode = feature.properties.code;\n\n            fetch(`https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/${region}/mutations-${region}-${departementCode}.json`)\n              .then(response => response.json())\n              .then(data => {\n                ventes = data;\n              });\n\n            fetch(`https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/${region}/communes-${region}.geojson`)\n              .then(function (response) {\n                return response.json();\n              })\n              .then(function (communes) {\n                var filteredCommunes = filterCommunes(departementCode, communes);\n\n                if (communesLayer) {\n                  map.removeLayer(communesLayer);\n                }\n\n                communesLayer = L.geoJSON(filteredCommunes, {\n                  onEachFeature: function (feature, layer) {\n                    layer.on('click', function () {\n                      var communeCode = feature.properties.code;\n\n                      var ventesDansCetteCommune = ventes.filter(vente => JSON.parse(vente.l_codinsee.replace(/'/g, \"\\\"\")).includes(communeCode));\n\n                      if (document.getElementById(\"Communes\").checked) {\n                        if (document.getElementById(\"Count\").checked) {\n                          totalVentes += ventesDansCetteCommune.length;\n                          document.getElementById(\"NumberSell\").textContent = \"Total: \" + totalVentes;\n                          layer.setStyle({ fillColor: 'red' });\n                          clickedCommunes.push(layer);\n                        } else {\n                          totalVentes = ventesDansCetteCommune.length;\n                          document.getElementById(\"NumberSell\").textContent = \"Total: \" + totalVentes;\n                        }\n                      } else if (document.getElementById(\"Sections\").checked) {\n                        fetch(`https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/${region}/sections-${region}-${departementCode}.json`)\n                          .then(function (response) {\n                            return response.json();\n                          })\n                          .then(function (sections) {\n                            var filteredSections = filterSections(communeCode, sections);\n\n                            if (sectionsLayer) {\n                              map.removeLayer(sectionsLayer);\n                            }\n\n                            sectionsLayer = L.geoJSON(filteredSections, {\n                              onEachFeature: function (feature, layer) {\n                                layer.on('click', function () {\n                                  var sectionCode = feature.properties.code;\n                                  var ventesDansCetteSection = ventes.filter(vente => JSON.parse(vente.l_section.replace(/'/g, \"\\\"\")).includes(sectionCode));\n\n                                  if (document.getElementById(\"Count\").checked) {\n                                    totalVentes += ventesDansCetteSection.length;\n                                    document.getElementById(\"NumberSell\").textContent = \"Total: \" + totalVentes;\n                                    layer.setStyle({ fillColor: 'red' });\n                                    clickedCommunes.push(layer);\n                                  } else {\n                                    totalVentes = ventesDansCetteSection.length;\n                                    document.getElementById(\"NumberSell\").textContent = \"Total: \" + totalVentes;\n                                  }\n                                });\n                              },\n                            });\n                            sectionsLayer.addTo(map);\n                          });\n                      }\n                    });\n                  },\n                });\n                communesLayer.addTo(map);\n              });\n          });\n        },\n      }).addTo(map);\n    });\n});\n\nfunction filterCommunes(departementCode, communes) {\n  return communes.features.filter(function (commune) {\n    return commune.properties.code.startsWith(departementCode);\n  });\n}\n\nfunction filterSections(communeCode, sections) {\n  return sections.features.filter(function (section) {\n    return section.id.startsWith(communeCode);\n  });\n}\n\n// Reset totalVentes and clickedCommunes when reset button is clicked\ndocument.getElementById(\"reset\").addEventListener('click', function () {\n  totalVentes = 0;\n  document.getElementById(\"NumberSell\").textContent = \"\";\n  clickedCommunes.forEach(function (commune) {\n    commune.setStyle({ fillColor: 'blue' });  // Replace 'blue' with your original color\n  });\n  clickedCommunes = [];\n});\n"]}