"use strict";var communesData,ventes,map=L.map("map").setView([45.7,3.15],7);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);var communesLayer,sectionsLayer,totalVentes=0,clickedCommunes=[],clickedSections=[],historyDiv=document.getElementById("Historique"),selectedCommunesCodinsee=[],selectedSectionsCodinsee=[],totalSecteur=0,select=document.getElementById("region");function filterCommunes(t,e){return e.features.filter(function(e){return e.properties.code.startsWith(t)})}function filterSections(t,e){return e.features.filter(function(e){return e.properties.id.startsWith(t)})}document.getElementById("egalmarcher").addEventListener("click",function(){var e=parseFloat(document.getElementById("nbventesclient").value)*totalVentes/100;console.log("RÃ©sultat du calcul :",e);var t=document.createElement("input");t.type="text",t.value=e,t.readOnly=!0;var n=document.getElementById("resultatmarcher");n.innerHTML="",n.appendChild(t)}),document.getElementById("Count").addEventListener("click",function(){0===clickedCommunes.length&&(totalVentes=0,document.getElementById("NumberSell").textContent="Total: "+totalVentes)}),document.getElementById("Export").addEventListener("click",function(){var e=document.querySelector(".pop-up-form .input-container");e.innerHTML="";var t=document.createElement("input");t.type="text",t.value=selectedCommunesCodinsee.map(function(e){return"".concat(e.nom,": ").concat(e.code)}).join(", "),t.readOnly=!0,e.appendChild(t);var n=document.createElement("input");n.type="text",n.value=selectedSectionsCodinsee.map(function(e){return"".concat(e.nom,": ").concat(e.code)}).join(", "),n.readOnly=!0,e.appendChild(n),selectedCommunesCodinsee.forEach(function(t){var e=ventes.flatMap(function(n){var e=JSON.parse(n.l_codinsee.replace(/'/g,'"')),o=JSON.parse(n.l_section.replace(/'/g,'"'));return e.map(function(e,t){return{id:e,section:o[t],vente:n}})}).filter(function(e){return e.id===t.code&&("1"===e.vente.idnatmut||"4"===e.vente.idnatmut)&&(e.vente.codtypbien.startsWith("1")&&"14"!==e.vente.codtypbien||"21"===e.vente.codtypbien)&&"2017"<=e.vente.anneemut&&e.vente.anneemut<="2020"});totalSecteur+=Math.round(e.length/4)}),selectedSectionsCodinsee.forEach(function(e){var t=e.code.substring(0,5)+"; "+e.code.substring(7),n=ventes.flatMap(function(n){var e=JSON.parse(n.l_codinsee.replace(/'/g,'"')),o=JSON.parse(n.l_section.replace(/'/g,'"'));return e.map(function(e,t){return{id:e+"000"+o[t],vente:n}})}).filter(function(e){return e.id===t&&("1"===e.vente.idnatmut||"4"===e.vente.idnatmut)&&(e.vente.codtypbien.startsWith("1")&&"14"!==e.vente.codtypbien||"21"===e.vente.codtypbien)&&"2017"<=e.vente.anneemut&&e.vente.anneemut<="2020"});totalSecteur+=Math.round(n.length/4)}),document.getElementById("TotalSecteur").value=totalSecteur}),select.addEventListener("change",function(){var i=this.value;map.eachLayer(function(e){map.removeLayer(e)}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map),fetch("https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/".concat(i,"/departements-").concat(i,".geojson")).then(function(e){return e.json()}).then(function(e){L.geoJSON(e,{onEachFeature:function(e,t){t.on("click",function(){var a=e.properties.code;fetch("https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/".concat(i,"/mutations-").concat(i,"-").concat(a,".json")).then(function(e){return e.json()}).then(function(e){ventes=e}),fetch("https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/".concat(i,"/communes-").concat(i,".geojson")).then(function(e){return e.json()}).then(function(e){var t=filterCommunes(a,communesData=e);communesLayer&&map.removeLayer(communesLayer),communesLayer=L.geoJSON(t,{onEachFeature:function(c,r){r.on({click:function(){var n=c.properties.code,e=c.properties.nom;if(historyDiv.textContent="Nom: "+e,document.getElementById("Create").checked){var t={code:n,nom:c.properties.nom};selectedCommunesCodinsee.push(t),r.setStyle({fillColor:"blue"})}if(!clickedCommunes.some(function(e){return e._leaflet_id===r._leaflet_id})){var o=ventes.flatMap(function(n){var e=JSON.parse(n.l_codinsee.replace(/'/g,'"')),o=JSON.parse(n.l_section.replace(/'/g,'"'));return e.map(function(e,t){return{id:e,section:o[t],vente:n}})}).filter(function(e){return e.id===n&&("1"===e.vente.idnatmut||"4"===e.vente.idnatmut)&&(e.vente.codtypbien.startsWith("1")&&"14"!==e.vente.codtypbien||"21"===e.vente.codtypbien)&&"2017"<=e.vente.anneemut&&e.vente.anneemut<="2020"});document.getElementById("Communes").checked&&(document.getElementById("Count").checked?(totalVentes+=Math.round(o.length/4),document.getElementById("NumberSell").textContent="Total: "+totalVentes,r.setStyle({fillColor:"red"}),clickedCommunes.push(r)):(totalVentes=Math.round(o.length/4),document.getElementById("NumberSell").textContent="Total: "+totalVentes)),document.getElementById("Sections").checked&&fetch("https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/".concat(i,"/sections-").concat(i,"-").concat(a,".json")).then(function(e){return e.json()}).then(function(e){var t=filterSections(n,e);sectionsLayer&&map.removeLayer(sectionsLayer),sectionsLayer=L.geoJSON(t,{onEachFeature:function(r,a){a.on("click",function(){var t=r.properties.id,n=t.substring(0,5),e=t.substring(8);if(document.getElementById("Create").checked){var o={code:n+"; "+e,nom:communesData.features.find(function(e){return e.properties.code===n}).properties.nom};selectedSectionsCodinsee.push(o),a.setStyle({fillColor:"green"})}if(!clickedSections.some(function(e){return e._leaflet_id===a._leaflet_id})){var c=ventes.flatMap(function(n){var e=JSON.parse(n.l_codinsee.replace(/'/g,'"')),o=JSON.parse(n.l_section.replace(/'/g,'"'));return e.map(function(e,t){return{id:e+"000"+o[t],vente:n}})}).filter(function(e){return e.id===t&&("1"===e.vente.idnatmut||"4"===e.vente.idnatmut)&&(e.vente.codtypbien.startsWith("1")&&"14"!==e.vente.codtypbien||"21"===e.vente.codtypbien)&&"2017"<=e.vente.anneemut&&e.vente.anneemut<="2020"});document.getElementById("Count").checked?(totalVentes+=Math.round(c.length/4),document.getElementById("NumberSell").textContent="Total: "+totalVentes,a.setStyle({fillColor:"red"}),clickedSections.push(a)):(totalVentes=Math.round(c.length/4),document.getElementById("NumberSell").textContent="Total: "+totalVentes)}})}}).addTo(map)})}}})}}).addTo(map)})})}}).addTo(map)})}),document.getElementById("reset").addEventListener("click",function(){totalVentes=0,document.getElementById("NumberSell").textContent="",clickedCommunes.forEach(function(e){e.setStyle({fillColor:"blue"})}),clickedCommunes=[]});
//# sourceMappingURL=scriptMap.min.js.map
