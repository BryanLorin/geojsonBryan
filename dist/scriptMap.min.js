"use strict";var communesData,ventes,map=L.map("map").setView([45.7,3.15],7);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map);var communesLayer,sectionsLayer,totalVentes=0,clickedCommunes=[],clickedSections=[],historyDiv=document.getElementById("Historique"),selectedCommunesCodinsee=[],selectedSectionsCodinsee=[],totalSecteur=0,select=document.getElementById("region"),totalVentes2=0;function filterCommunes(t,e){return e.features.filter(function(e){return e.properties.code.startsWith(t)})}function filterSections(t,e){return e.features.filter(function(e){return e.properties.id.startsWith(t)})}document.getElementById("nbVentesClient").addEventListener("input",function(){var e=this.value;if(isNaN(e)||""===e.trim())document.getElementById("resultatMarche").textContent="Résultat marché: 0";else{var t=totalVentes2*e/100;document.getElementById("resultatMarche").textContent="Résultat marché: "+t}}),document.getElementById("Count").addEventListener("click",function(){0===clickedCommunes.length&&(totalVentes2=totalVentes=0,document.getElementById("NumberSell").textContent="Total: "+totalVentes,document.getElementById("NumberSell2").textContent="Total 2: "+totalVentes2)}),document.getElementById("Export").addEventListener("click",function(){var e=document.querySelector(".pop-up-form .input-container");e.innerHTML="";var t=document.createElement("input");t.type="text",t.value=selectedCommunesCodinsee.map(function(e){return"".concat(e.nom,": ").concat(e.code)}).join(", "),t.readOnly=!0,e.appendChild(t);var n=document.createElement("input");n.type="text",n.value=selectedSectionsCodinsee.map(function(e){return"".concat(e.nom,": ").concat(e.code)}).join(", "),n.readOnly=!0,e.appendChild(n),selectedCommunesCodinsee.forEach(function(t){var e=ventes.flatMap(function(n){var e=JSON.parse(n.l_codinsee.replace(/'/g,'"')),o=JSON.parse(n.l_section.replace(/'/g,'"'));return e.map(function(e,t){return{id:e,section:o[t],vente:n}})}).filter(function(e){return e.id===t.code&&("1"===e.vente.idnatmut||"4"===e.vente.idnatmut)&&(e.vente.codtypbien.startsWith("1")&&"14"!==e.vente.codtypbien||"21"===e.vente.codtypbien)&&"2017"<=e.vente.anneemut&&e.vente.anneemut<="2020"});totalSecteur+=Math.round(e.length/4)}),selectedSectionsCodinsee.forEach(function(e){var t=e.code.substring(0,5)+"; "+e.code.substring(7),n=ventes.flatMap(function(n){var e=JSON.parse(n.l_codinsee.replace(/'/g,'"')),o=JSON.parse(n.l_section.replace(/'/g,'"'));return e.map(function(e,t){return{id:e+"000"+o[t],vente:n}})}).filter(function(e){return e.id===t&&("1"===e.vente.idnatmut||"4"===e.vente.idnatmut)&&(e.vente.codtypbien.startsWith("1")&&"14"!==e.vente.codtypbien||"21"===e.vente.codtypbien)&&"2017"<=e.vente.anneemut&&e.vente.anneemut<="2020"});totalSecteur+=Math.round(n.length/4)}),document.getElementById("TotalSecteur").value=totalSecteur}),select.addEventListener("change",function(){var l=this.value;map.eachLayer(function(e){map.removeLayer(e)}),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{maxZoom:19}).addTo(map),fetch("https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/".concat(l,"/departements-").concat(l,".geojson")).then(function(e){return e.json()}).then(function(e){L.geoJSON(e,{onEachFeature:function(e,t){t.on("click",function(){var i=e.properties.code;fetch("https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/".concat(l,"/mutations-").concat(l,"-").concat(i,".json")).then(function(e){return e.json()}).then(function(e){ventes=e}),fetch("https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/".concat(l,"/communes-").concat(l,".geojson")).then(function(e){return e.json()}).then(function(e){var t=filterCommunes(i,communesData=e);communesLayer&&map.removeLayer(communesLayer),communesLayer=L.geoJSON(t,{onEachFeature:function(a,r){r.on({click:function(){var n=a.properties.code,e=a.properties.nom;if(historyDiv.textContent="Nom: "+e,document.getElementById("Create").checked){var t={code:n,nom:a.properties.nom};selectedCommunesCodinsee.push(t),r.setStyle({fillColor:"blue"})}if(!clickedCommunes.some(function(e){return e._leaflet_id===r._leaflet_id})){var o=ventes.flatMap(function(n){var e=JSON.parse(n.l_codinsee.replace(/'/g,'"')),o=JSON.parse(n.l_section.replace(/'/g,'"'));return e.map(function(e,t){return{id:e,section:o[t],vente:n}})}).filter(function(e){return e.id===n&&("1"===e.vente.idnatmut||"4"===e.vente.idnatmut)&&(e.vente.codtypbien.startsWith("1")&&"14"!==e.vente.codtypbien||"21"===e.vente.codtypbien)&&"2017"<=e.vente.anneemut&&e.vente.anneemut<="2020"});if(document.getElementById("Communes").checked)if(document.getElementById("Count").checked){var c=Math.round(ventesDansCetteSection.length/4);totalVentes+=c,totalVentes2+=c,document.getElementById("NumberSell").textContent="Total: "+totalVentes,document.getElementById("NumberSell2").textContent="Total 2: "+totalVentes2,r.setStyle({fillColor:"red"}),clickedCommunes.push(r)}else totalVentes=Math.round(o.length/4),document.getElementById("NumberSell").textContent="Total: "+totalVentes,document.getElementById("NumberSell2").textContent="Total 2: "+totalVentes2;document.getElementById("Sections").checked&&fetch("https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/".concat(l,"/sections-").concat(l,"-").concat(i,".json")).then(function(e){return e.json()}).then(function(e){var t=filterSections(n,e);sectionsLayer&&map.removeLayer(sectionsLayer),sectionsLayer=L.geoJSON(t,{onEachFeature:function(r,i){i.on("click",function(){var t=r.properties.id,n=t.substring(0,5),e=t.substring(8);if(document.getElementById("Create").checked){var o={code:n+"; "+e,nom:communesData.features.find(function(e){return e.properties.code===n}).properties.nom};selectedSectionsCodinsee.push(o),i.setStyle({fillColor:"green"})}if(!clickedSections.some(function(e){return e._leaflet_id===i._leaflet_id})){var c=ventes.flatMap(function(n){var e=JSON.parse(n.l_codinsee.replace(/'/g,'"')),o=JSON.parse(n.l_section.replace(/'/g,'"'));return e.map(function(e,t){return{id:e+"000"+o[t],vente:n}})}).filter(function(e){return e.id===t&&("1"===e.vente.idnatmut||"4"===e.vente.idnatmut)&&(e.vente.codtypbien.startsWith("1")&&"14"!==e.vente.codtypbien||"21"===e.vente.codtypbien)&&"2017"<=e.vente.anneemut&&e.vente.anneemut<="2020"});if(document.getElementById("Count").checked){var a=Math.round(c.length/4);totalVentes+=a,totalVentes2+=a,document.getElementById("NumberSell").textContent="Total: "+totalVentes,document.getElementById("NumberSell2").textContent="Total 2: "+totalVentes2,i.setStyle({fillColor:"red"}),clickedSections.push(i)}else totalVentes=Math.round(c.length/4),document.getElementById("NumberSell").textContent="Total: "+totalVentes,document.getElementById("NumberSell2").textContent="Total 2: "+totalVentes2}})}}).addTo(map)})}}})}}).addTo(map)})})}}).addTo(map)})}),document.getElementById("reset").addEventListener("click",function(){totalVentes2=totalVentes=0,document.getElementById("NumberSell").textContent="",document.getElementById("NumberSell2").textContent="",clickedCommunes.forEach(function(e){e.setStyle({fillColor:"blue"})}),clickedCommunes=[]});
//# sourceMappingURL=scriptMap.min.js.map
