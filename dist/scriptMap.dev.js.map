{"version":3,"sources":["scriptMap.js"],"names":["map","L","setView","tileLayer","maxZoom","addTo","ventes","totalVentes","clickedCommunes","communesLayer","sectionsLayer","select","document","getElementById","addEventListener","region","value","eachLayer","layer","removeLayer","fetch","then","response","json","departements","geoJSON","onEachFeature","feature","on","departementCode","properties","code","data","communes","filteredCommunes","filterCommunes","communeCode","ventesDansCetteCommune","filter","vente","JSON","parse","l_codinsee","replace","includes","checked","length","textContent","setStyle","fillColor","push","sections","filteredSections","filterSections","sectionCode","ventesDansCetteSection","l_section","features","commune","startsWith","section","id","forEach"],"mappings":"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","sourcesContent":["var map = L.map('map').setView([45.7, 3.15], 7);\n\nL.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n  maxZoom: 19,\n}).addTo(map);\n\nvar ventes;\nvar totalVentes = 0;\nvar clickedCommunes = [];\n\nvar communesLayer;\nvar sectionsLayer;\nvar select = document.getElementById('region');\n\nselect.addEventListener('change', function () {\n  var region = this.value;\n  map.eachLayer(function (layer) {\n    map.removeLayer(layer);\n  });\n\n  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n    maxZoom: 19,\n  }).addTo(map);\n\n  fetch(`https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/${region}/departements-${region}.geojson`)\n    .then(function (response) {\n      return response.json();\n    })\n    .then(function (departements) {\n      L.geoJSON(departements, {\n        onEachFeature: function (feature, layer) {\n          layer.on('click', function () {\n            var departementCode = feature.properties.code;\n\n            fetch(`https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/${region}/mutations-${region}-${departementCode}.json`)\n              .then(response => response.json())\n              .then(data => {\n                ventes = data;\n              });\n\n            fetch(`https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/${region}/communes-${region}.geojson`)\n              .then(function (response) {\n                return response.json();\n              })\n              .then(function (communes) {\n                var filteredCommunes = filterCommunes(departementCode, communes);\n\n                if (communesLayer) {\n                  map.removeLayer(communesLayer);\n                }\n\n                communesLayer = L.geoJSON(filteredCommunes, {\n                  onEachFeature: function (feature, layer) {\n                    layer.on('click', function () {\n                      var communeCode = feature.properties.code;\n\n                      var ventesDansCetteCommune = ventes.filter(vente => JSON.parse(vente.l_codinsee.replace(/'/g, \"\\\"\")).includes(communeCode));\n\n                      if (document.getElementById(\"Communes\").checked) {\n                        if (document.getElementById(\"Count\").checked) {\n                          totalVentes += ventesDansCetteCommune.length;\n                          document.getElementById(\"NumberSell\").textContent = \"Total: \" + totalVentes;\n                          layer.setStyle({ fillColor: 'red' });\n                          clickedCommunes.push(layer);\n                        } else {\n                          totalVentes = ventesDansCetteCommune.length;\n                          document.getElementById(\"NumberSell\").textContent = \"Total: \" + totalVentes;\n                        }\n                      } else if (document.getElementById(\"Sections\").checked) {\n                        fetch(`https://raw.githubusercontent.com/BryanLorin/geojsonBryan/main/${region}/sections-${region}-${departementCode}.json`)\n                          .then(function (response) {\n                            return response.json();\n                          })\n                          .then(function (sections) {\n                            var filteredSections = filterSections(communeCode, sections);\n\n                            if (sectionsLayer) {\n                              map.removeLayer(sectionsLayer);\n                            }\n\n                            sectionsLayer = L.geoJSON(filteredSections, {\n                              onEachFeature: function (feature, layer) {\n                                layer.on('click', function () {\n                                  var sectionCode = feature.properties.code;\n                                  var ventesDansCetteSection = ventes.filter(vente => JSON.parse(vente.l_section.replace(/'/g, \"\\\"\")).includes(sectionCode));\n\n                                  if (document.getElementById(\"Count\").checked) {\n                                    totalVentes += ventesDansCetteSection.length;\n                                    document.getElementById(\"NumberSell\").textContent = \"Total: \" + totalVentes;\n                                    layer.setStyle({ fillColor: 'red' });\n                                    clickedCommunes.push(layer);\n                                  } else {\n                                    totalVentes = ventesDansCetteSection.length;\n                                    document.getElementById(\"NumberSell\").textContent = \"Total: \" + totalVentes;\n                                  }\n                                });\n                              },\n                            });\n                            sectionsLayer.addTo(map);\n                          });\n                      }\n                    });\n                  },\n                });\n                communesLayer.addTo(map);\n              });\n          });\n        },\n      }).addTo(map);\n    });\n});\n\nfunction filterCommunes(departementCode, communes) {\n  return communes.features.filter(function (commune) {\n    return commune.properties.code.startsWith(departementCode);\n  });\n}\n\nfunction filterSections(communeCode, sections) {\n  return sections.features.filter(function (section) {\n    return section.id.startsWith(communeCode);\n  });\n}\n\n// Reset totalVentes and clickedCommunes when reset button is clicked\ndocument.getElementById(\"reset\").addEventListener('click', function () {\n  totalVentes = 0;\n  document.getElementById(\"NumberSell\").textContent = \"\";\n  clickedCommunes.forEach(function (commune) {\n    commune.setStyle({ fillColor: 'blue' });  // Replace 'blue' with your original color\n  });\n  clickedCommunes = [];\n});\n"],"file":"scriptMap.dev.js"}